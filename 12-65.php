<?php

include(__DIR__ . '/include/generator.php');

$sql = "INSERT INTO `nationalplayerday` VALUES (10,4,14880,347),(11,4,14879,347),(11,4,14881,347),(11,4,18016,347),(10,4,14899,347),(11,4,14896,347),(10,4,18137,347),(7,4,14882,347),(9,4,14884,347),(9,4,14894,347),(8,4,14897,347),(1,4,14769,344),(2,4,15242,355),(7,4,14898,347),(2,4,15237,355),(1,4,14639,341),(10,7,1814,43),(1,7,2642,62),(3,7,1816,43),(1,7,1826,43),(3,7,1815,43),(3,7,1810,43),(11,7,1813,43),(11,7,1811,43),(11,7,1812,43),(11,7,1809,43),(11,7,1807,43),(2,7,1907,45),(3,7,1825,43),(2,7,1609,38),(2,7,1910,45),(3,7,1831,43),(6,11,18006,207),(1,11,9865,230),(9,11,9048,211),(1,11,10080,235),(10,11,18354,216),(1,11,10210,238),(3,11,8834,206),(6,11,8876,207),(6,11,9263,216),(1,11,9135,213),(6,11,8961,209),(5,11,9392,219),(7,11,8962,209),(7,11,9049,211),(6,11,9246,216),(5,1,12184,284),(8,1,12949,302),(10,1,11955,279),(7,1,12213,285),(6,1,12945,302),(10,1,12180,284),(10,1,12517,43),(9,1,11929,278),(11,1,18123,278),(10,1,11740,274),(4,1,12042,281),(9,1,11757,274),(9,1,11760,274),(9,1,11758,274),(9,1,11759,274),(9,1,11761,274),(9,3,619,15),(9,3,362,9),(10,3,407,10),(9,3,105,3),(7,3,620,15),(5,3,621,15),(3,3,879,21),(9,3,405,10),(4,3,1434,34),(11,3,618,15),(1,3,147,4),(11,3,404,10),(2,3,1437,34),(3,3,1006,24),(4,3,533,13),(10,3,1264,30),(5,10,7839,183),(10,10,8188,191),(11,10,7628,178),(6,10,7845,183),(10,10,8017,187),(11,10,8015,187),(6,10,7588,177),(8,10,7930,185),(4,10,7499,175),(9,10,7415,173),(5,10,8703,203),(9,10,7757,181),(7,10,7583,177),(9,10,7844,183),(10,10,7586,177),(11,10,7328,171),(11,9,18210,115),(1,9,4963,116),(5,9,4532,106),(5,9,4406,103),(4,9,18227,107),(4,9,4405,103),(5,9,18228,107),(1,9,4407,103),(4,9,4533,106),(6,9,4403,103),(5,9,4879,50),(1,9,4448,104),(4,9,4408,103),(2,9,4659,109),(2,9,4748,111),(1,9,4791,112),(4,2,13821,322),(2,2,14381,335),(1,2,13434,313),(3,2,14421,336),(6,2,13820,322),(7,2,14380,335),(2,2,13476,314),(3,2,13217,308),(2,2,18266,339),(8,2,18381,312),(1,2,13302,310),(1,2,13479,314),(2,2,14383,335),(4,2,14425,336),(4,2,13219,308),(2,2,14378,335),(8,12,6339,148),(9,12,6511,152),(3,12,6423,150),(10,12,18089,152),(11,12,18352,148),(7,12,6468,151),(11,12,6382,149),(5,12,6082,142),(9,12,6384,149),(10,12,6381,149),(4,12,6080,142),(11,12,6322,148),(6,12,6078,142),(9,12,6383,149),(1,12,6123,143),(9,12,6338,148),(1,8,17805,383),(11,8,16212,378),(11,8,17553,390),(11,8,16943,395),(11,8,17504,408),(11,8,16728,390),(1,8,16658,388),(9,8,18426,407),(11,8,17330,404),(11,8,18344,383),(6,8,16514,385),(1,8,18557,382),(4,8,16216,43),(3,8,16126,376),(2,8,16556,386),(1,8,16959,395),(7,6,18145,239),(3,6,10251,239),(4,6,10553,246),(11,6,10725,250),(4,6,11580,270),(4,6,10253,239),(11,6,10854,253),(1,6,11586,270),(1,6,18477,248),(8,6,10593,247),(2,6,11584,270),(2,6,18476,248),(2,6,11670,272),(2,6,11585,270),(1,6,10338,241),(7,6,10811,252),(8,5,2983,70),(1,5,4146,97),(9,5,3459,81),(2,5,3097,73),(1,5,4360,102),(1,5,4275,100),(3,5,3758,88),(5,5,3974,93),(1,5,3287,77),(7,5,3284,77),(5,5,2968,70),(1,5,4363,102),(1,5,3753,88),(1,5,3756,88),(5,5,3416,16),(3,5,4172,98),(2,3,1438,34),(4,3,408,10),(3,7,2511,59),(1,7,2212,52),(2,7,1909,45),(3,7,2386,56),(2,7,1832,43),(1,7,2129,50),(2,7,2126,50),(1,7,2124,50),(1,7,2595,61),(4,7,1808,43),(5,8,16558,386),(10,8,16599,387),(2,8,16745,390),(2,8,16744,390),(1,8,17518,408),(3,11,9134,213),(1,11,10037,234),(1,11,9863,230),(2,11,9306,217),(2,11,8833,206),(2,11,9778,228),(3,11,9176,214),(1,11,8790,205),(3,6,10252,239),(1,6,18474,248),(2,6,11370,265),(7,4,14883,347),(3,4,15972,310),(2,4,14900,347),(3,4,15757,247),(4,1,12187,284),(9,1,12516,43),(4,9,4402,103),(3,9,4447,104),(3,9,4531,106),(4,9,4399,103),(3,9,4401,103),(1,9,4397,103),(3,9,4792,112),(2,9,4537,106),(5,9,5435,127),(10,10,7501,175),(7,10,7585,177),(3,10,7630,178),(1,12,6122,143),(7,12,6341,148),(5,12,6513,152),(8,12,6425,150),(1,2,13307,310),(5,2,14422,336),(2,2,13301,310),(1,2,13690,319),(3,2,13305,310),(2,2,13692,319),(1,2,13306,310),(2,2,13632,318),(4,2,13822,322),(4,2,14379,335),(7,2,13737,320),(1,2,18141,308),(1,5,2985,241),(1,5,4061,95),(1,5,3199,75),(1,5,18397,75),(2,5,3114,150),(1,5,4188,98),(1,5,3242,76),(1,5,3115,210),(9,5,3802,89),(1,8,16255,379),(1,8,18310,376),(3,8,18124,396),(3,8,17072,398),(1,4,15236,355),(2,4,14637,341),(1,4,14937,348),(5,4,14895,347),(1,7,1830,43),(4,7,18358,43),(2,7,1833,43),(1,7,1823,43),(1,7,17627,54),(4,7,1938,43),(1,7,2210,52),(2,7,2125,50),(2,6,10250,239),(2,6,10254,239),(8,6,10856,253),(7,6,10855,253),(5,6,10852,253),(7,6,10858,253),(5,6,10722,250),(6,6,10719,250),(8,6,10723,250),(4,6,10728,250),(5,11,18290,216),(1,11,10036,234),(7,3,406,10),(7,3,663,16),(2,9,4793,112),(2,9,4790,112),(2,9,4451,104),(1,9,4663,109),(1,9,4747,111),(3,9,4398,103),(1,9,5440,127),(1,9,18304,103),(1,9,4658,109),(1,2,13651,318),(1,2,14419,336),(1,2,13308,310),(2,2,13220,275),(1,2,13695,319),(3,2,13736,320),(1,2,14426,336),(8,12,6378,149),(5,5,4018,94),(1,5,3966,93),(8,5,3929,92),(1,5,3968,93),(1,5,4105,96),(1,5,3324,78),(4,5,18136,70),(6,5,2981,70),(1,5,4232,99),(5,10,7893,184),(6,10,18183,186),(7,10,7326,171),(1,4,15240,355),(1,4,15456,360),(1,4,15243,355),(3,6,10596,247),(6,6,10594,247),(6,6,10592,247),(4,6,10726,250),(6,6,10595,247),(2,6,10597,247),(8,8,18054,375),(1,8,16746,390),(1,7,2383,56),(1,7,1479,35),(2,7,2123,50),(1,7,2168,51),(1,7,1655,39),(6,11,8874,207),(3,11,8964,207),(3,11,8875,207),(5,11,18337,211),(5,11,9031,211),(5,11,8870,207),(6,1,18142,275),(3,1,11754,274),(2,1,12299,287),(2,2,13650,318),(3,2,14164,330),(3,2,13735,320),(3,2,13693,319),(2,2,14169,330),(3,2,14162,330),(1,2,14168,330),(1,2,14377,335),(3,2,13691,319),(2,9,4450,104),(3,9,4910,115),(3,9,4535,106),(3,9,4919,115),(8,5,3325,78),(8,5,3329,78),(4,5,3333,78),(8,5,3328,78),(8,5,4233,99),(7,5,3934,92),(7,5,3933,92),(5,5,3327,78),(6,5,3456,81),(1,3,1050,25),(1,3,878,21),(2,3,1052,25),(1,3,1222,29),(2,3,534,13),(4,10,7324,171),(1,10,7886,184),(3,6,10383,242),(2,6,10382,242),(1,6,10380,242),(3,8,16559,386),(1,3,444,11),(1,4,14640,341),(5,4,18934,347),(7,4,18093,349),(1,4,14768,344),(2,7,1993,47),(2,7,18135,43),(6,7,17549,50),(1,7,1725,347),(3,5,4129,97),(6,5,3931,92),(4,11,8878,207),(4,11,8871,207),(2,11,8965,336),(3,11,8879,207),(2,11,8877,207),(2,11,9005,210),(3,11,8945,209),(1,9,5307,124),(1,9,5311,124),(1,9,5004,117),(3,9,4920,115),(2,9,4390,103),(1,9,4788,112),(1,9,4789,112),(1,9,4876,114),(1,9,4795,112),(5,1,13118,43),(1,12,6340,148),(5,12,18904,152),(7,12,6380,149),(4,2,14424,336),(3,2,13864,323),(3,2,13866,323),(3,2,13519,315),(2,2,13732,320),(3,2,14423,336),(1,2,13176,307),(1,10,7888,184),(1,4,14766,344),(2,4,14722,343),(2,4,14767,344),(4,4,18585,347),(1,6,10381,242),(6,8,18055,375),(6,8,18298,375),(6,8,18395,375),(6,8,18953,375),(2,8,17854,396),(2,3,1267,30),(4,3,19,1),(3,3,104,3),(4,3,1310,31),(1,3,142,4),(1,7,1824,43),(5,7,2108,50),(2,9,4835,113),(3,9,4921,115),(2,9,5179,121),(2,9,4750,111),(2,9,4923,115),(3,9,4489,105),(1,11,9262,216),(1,11,9260,216),(1,11,9479,221),(2,2,13349,311),(1,2,13177,307),(2,2,13473,314),(3,5,3883,91),(3,5,3198,75),(1,4,18738,354),(1,7,1564,50),(1,6,10339,96),(1,6,10857,253),(1,6,10591,247),(3,1,12185,284),(1,9,4833,113),(1,9,5182,121),(4,12,6064,142),(2,2,13647,318),(1,2,13605,317),(1,2,13646,318),(1,2,13561,47),(1,2,13865,323),(2,11,18001,103),(2,11,9050,211),(1,11,9261,216),(1,11,9308,217),(1,11,9004,210),(2,11,9040,211),(1,11,9476,221),(2,11,9003,210),(1,11,9006,210),(2,11,9007,210),(1,3,1308,31),(3,3,233,6),(4,8,19170,375),(4,7,18284,47),(4,7,1635,39),(2,7,1850,44),(4,7,18361,51),(4,7,2153,51),(2,7,18394,54),(1,4,15068,351),(1,4,14852,346),(1,4,18739,354),(1,4,18740,354),(1,11,9047,211),(1,9,5051,118),(1,9,5306,124),(1,9,5134,120),(1,9,5263,123),(1,9,4922,115),(1,9,5047,118),(1,9,5824,136),(1,9,4917,115),(1,9,4834,113),(1,9,4924,115),(1,9,4529,106),(1,9,5737,134),(1,12,5909,40),(1,2,14165,330),(1,2,13520,315),(1,2,14595,340),(1,2,14334,334),(1,2,13995,326),(1,2,13394,312),(1,4,15840,369),(1,1,12961,302),(1,8,16560,386),(2,7,17611,54),(3,7,18325,39),(2,9,5176,121),(2,9,5090,119),(1,9,4443,104),(1,9,5007,117),(2,9,4664,109),(2,9,5608,131),(1,9,4837,113),(2,9,5261,123),(2,2,13347,279),(2,2,14208,331),(1,2,13951,325),(1,2,14509,338),(1,2,13648,318),(1,2,13341,85),(1,2,14036,327),(1,2,14081,328),(1,2,13949,325),(2,2,14122,329),(1,3,101,3),(3,12,18115,148),(1,6,10727,250),(1,6,10336,241),(1,11,9265,178),(2,11,9264,275),(2,11,9046,211),(1,11,8966,209),(1,11,9389,219),(2,3,18362,15),(2,3,98,3),(2,3,389,10),(1,3,140,4),(2,3,400,10),(2,3,614,15),(1,3,346,9),(2,3,347,9),(2,3,18119,15),(2,3,272,7),(2,1,12100,43),(2,1,19125,43),(1,1,12190,284),(1,7,1979,47),(1,7,18341,35),(1,2,14037,327),(1,2,13260,309),(1,2,13689,319),(1,2,14295,333),(1,2,14082,328),(1,2,13818,322),(1,2,13823,322),(1,9,4964,116),(1,9,5565,130),(1,9,5777,135),(1,9,4744,111),(1,9,4661,109),(1,9,5438,127),(1,12,7199,168),(1,11,10079,235),(1,11,8919,207),(1,1,11799,275),(1,1,11801,275),(1,1,11697,273),(1,3,1175,28),(1,3,18245,9),(1,3,369,9),(1,3,1051,25),(1,7,18103,35),(1,2,13348,311),(1,2,13603,317),(1,2,13478,131),(1,2,14510,338),(1,9,5651,132),(1,9,4400,103),(1,9,4707,110),(1,6,18856,262),(1,6,10597,277),(1,6,10837,253),(1,6,10364,242),(1,6,11439,267),(1,6,10708,250),(1,12,6371,149),(1,11,17925,320),(1,11,17980,207),(1,11,17927,207),(1,11,17898,153);";
f_igosja_mysqli_query($sql);

$sql = "SELECT `history_user_id`,
               `history_national_id`,
               `history_date`,
               `history_historytext_id`
        FROM `history`
        WHERE `history_historytext_id` IN (" . HISTORYTEXT_USER_MANAGER_NATIONAL_IN . ", " . HISTORYTEXT_USER_VICE_NATIONAL_IN . ")";
$user_sql = f_igosja_mysqli_query($sql);

$user_array = $user_sql->fetch_all(MYSQLI_ASSOC);

foreach ($user_array as $user)
{
    $user_id        = $user['history_user_id'];
    $national_id    = $user['history_national_id'];
    $date           = $user['history_date'];

    if (HISTORYTEXT_USER_MANAGER_NATIONAL_IN == $user['history_historytext_id'])
    {
        $text_id = HISTORYTEXT_USER_MANAGER_NATIONAL_OUT;
    }
    else
    {
        $text_id = HISTORYTEXT_USER_VICE_NATIONAL_OUT;
    }

    $sql = "SELECT `history_date`
            FROM `history`
            WHERE `history_historytext_id`=$text_id
            AND `history_national_id`=$national_id
            AND `history_date`>$date
            ORDER BY `history_id` ASC
            LIMIT 1";
    $fire_sql = f_igosja_mysqli_query($sql);

    $fire_array = $fire_sql->fetch_all(MYSQLI_ASSOC);

    $day = round(($fire_array[0]['history_date'] - $date) / 24 / 60 / 60 );

    $sql = "SELECT COUNT(*) AS `count`
            FROM `nationaluserday`
            WHERE `nationaluserday_national_id`=$national_id
            AND `nationaluserday_user_id`=$user_id";
    $check_sql = f_igosja_mysqli_query($sql);

    $check_array = $check_sql->fetch_all(MYSQLI_ASSOC);

    if (0 == $check_array[0]['count'])
    {
        $sql = "INSERT INTO `nationaluserday`
                SET `nationaluserday_day`=$day,
                    `nationaluserday_national_id`=$national_id,
                    `nationaluserday_user_id`=$user_id";
        f_igosja_mysqli_query($sql);
    }
    else
    {
        $sql = "UPDATE `nationaluserday`
                SET `nationaluserday_day`=`nationaluserday_day`+$day
                WHERE `nationaluserday_national_id`=$national_id
                AND `nationaluserday_user_id`=$user_id";
        f_igosja_mysqli_query($sql);
    }
}

$sql = "SELECT `national_id`,
                   `national_finance`
            FROM `national`
            WHERE `national_finance`>0
            AND `national_id`!=0";
$national_sql = f_igosja_mysqli_query($sql);

$national_array = $national_sql->fetch_all(MYSQLI_ASSOC);

foreach ($national_array as $national)
{
    $national_id    = $national['national_id'];
    $money_national = $national['national_finance'];
    $money_coach    = round($money_national / 5);
    $money_player   = $national['national_finance'] - $money_coach;

    $sql = "SELECT SUM(`nationaluserday_day`) AS `total`
                FROM `nationaluserday`
                WHERE `nationaluserday_national_id`=$national_id";
    $total_sql = f_igosja_mysqli_query($sql);

    $total_array = $total_sql->fetch_all(MYSQLI_ASSOC);

    $total = $total_array[0]['total'];

    $sql = "SELECT `nationaluserday_day`,
                       `nationaluserday_user_id`
                FROM `nationaluserday`
                WHERE `nationaluserday_national_id`=$national_id
                ORDER BY `nationaluserday_user_id` ASC";
    $nationaluser_sql = f_igosja_mysqli_query($sql);

    $nationaluser_array = $nationaluser_sql->fetch_all(MYSQLI_ASSOC);

    foreach ($nationaluser_array as $user)
    {
        $user_id    = $user['nationaluserday_user_id'];
        $money      = round($money_coach / $total * $user['nationaluserday_day']);

        $sql = "SELECT `user_finance`
                    FROM `user`
                    WHERE `user_id`=$user_id
                    LIMIT 1";
        $user_sql = f_igosja_mysqli_query($sql);

        $user_array = $user_sql->fetch_all(MYSQLI_ASSOC);

        $finance = array(
            'finance_financetext_id' => FINANCETEXT_INCOME_COACH,
            'finance_user_id' => $user_id,
            'finance_value' => $money,
            'finance_value_after' => $user_array[0]['user_finance'] + $money,
            'finance_value_before' => $user_array[0]['user_finance'],
        );

        f_igosja_finance($finance);

        $sql = "UPDATE `user`
                    SET `user_finance`=`user_finance`+$money
                    WHERE `user_id`=$user_id
                    LIMIT 1";
        f_igosja_mysqli_query($sql);
    }

    $sql = "SELECT SUM(`nationalplayerday_day`) AS `total`
                FROM `nationalplayerday`
                WHERE `nationalplayerday_national_id`=$national_id";
    $total_sql = f_igosja_mysqli_query($sql);

    $total_array = $total_sql->fetch_all(MYSQLI_ASSOC);

    $total = $total_array[0]['total'];

    $sql = "SELECT SUM(`nationalplayerday_day`) AS `total`,
                       `nationalplayerday_team_id`
                FROM `nationalplayerday`
                WHERE `nationalplayerday_national_id`=$national_id
                GROUP BY `nationalplayerday_team_id`
                ORDER BY `nationalplayerday_team_id` ASC";
    $nationalteam_sql = f_igosja_mysqli_query($sql);

    $nationalteam_array = $nationalteam_sql->fetch_all(MYSQLI_ASSOC);

    foreach ($nationalteam_array as $team)
    {
        $team_id    = $team['nationalplayerday_team_id'];
        $money      = round($money_player / $total * $team['total']);

        $sql = "SELECT `team_finance`
                    FROM `team`
                    WHERE `team_id`=$team_id
                    LIMIT 1";
        $team_sql = f_igosja_mysqli_query($sql);

        $team_array = $team_sql->fetch_all(MYSQLI_ASSOC);

        $finance = array(
            'finance_financetext_id' => FINANCETEXT_INCOME_NATIONAL,
            'finance_team_id' => $team_id,
            'finance_value' => $money,
            'finance_value_after' => $team_array[0]['team_finance'] + $money,
            'finance_value_before' => $team_array[0]['team_finance'],
        );

        f_igosja_finance($finance);

        $sql = "UPDATE `team`
                    SET `team_finance`=`team_finance`+$money
                    WHERE `team_id`=$team_id
                    LIMIT 1";
        f_igosja_mysqli_query($sql);
    }

    $finance = array(
        'finance_financetext_id' => FINANCETEXT_OUTCOME_NATIONAL,
        'finance_national_id' => $national_id,
        'finance_value' => -$money_national,
        'finance_value_after' => 0,
        'finance_value_before' => $money_national,
    );

    f_igosja_finance($finance);

    $sql = "UPDATE `national`
                SET `national_finance`=0
                WHERE `national_id`=$national_id";
    f_igosja_mysqli_query($sql);
}

$sql = "TRUNCATE `nationaluserday`";
f_igosja_mysqli_query($sql);

$sql = "TRUNCATE `nationalplayerday`";
f_igosja_mysqli_query($sql);